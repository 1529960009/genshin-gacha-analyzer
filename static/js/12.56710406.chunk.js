(this["webpackJsonpgenshin-gacha-analyzer"]=this["webpackJsonpgenshin-gacha-analyzer"]||[]).push([[12],{481:function(t,e,n){"use strict";n.r(e),n.d(e,"AnalysisChart",(function(){return ft}));var r=n(12),c=n(4),a=n(13),i=n(294),o=n(290),u=n(89),l=n(69),f=n(0),h=n(459),s=n.n(h),b=n(127),d=n(33),p=n(108),v=n(326),g=n(340),O=n(467),j=n(480),m=n(475),x=n(478),y=n(484),w=n(451),S=n.n(w);v.a([O.a,j.a,m.a,x.a,y.a]);var C=function(t){var e=t.onCreate,n=Object(p.a)(t,["onCreate"]),r=Object(f.useRef)(null);return Object(f.useEffect)((function(){var t,n;return r.current&&(t=g.b(r.current),e(t),n=S()((function(){t.resize()}),100),window.addEventListener("resize",n)),function(){t&&(t.dispose(),window.removeEventListener("resize",n))}}),[]),Object(c.b)("div",Object(d.a)({ref:r},n))},E=n(23),T=n(452),A=n.n(T),R=n(456),k=n.n(R),F=function(t){return new Date(t).toLocaleDateString()},z=function(t,e){return"".concat(Math.round(t/e*1e4)/100,"%")},H=[{pct:0,color:{r:46,g:200,b:5}},{pct:.77,color:{r:67,g:93,b:250}},{pct:1,color:{r:255,g:0,b:0}}],M=function(t){for(var e=1;e<H.length-1&&!(t<H[e].pct);e++);var n=H[e-1],r=H[e],c=r.pct-n.pct,a=(t-n.pct)/c,i=1-a,o=a,u={r:Math.floor(n.color.r*i+r.color.r*o),g:Math.floor(n.color.g*i+r.color.g*o),b:Math.floor(n.color.b*i+r.color.b*o)};return"rgb("+[u.r,u.g,u.b].join(",")+")"};function _(){var t=Object(r.a)(["\n            text-align: center;\n            span {\n              color: grey;\n            }\n          "]);return _=function(){return t},t}function D(){var t=Object(r.a)(["\n          padding: 0 50px;\n        "]);return D=function(){return t},t}function I(){var t=Object(r.a)(["\n          height: 300px;\n        "]);return I=function(){return t},t}function P(){var t=Object(r.a)(["\n        display: inline-block;\n        width: 100%;\n        max-width: 450px;\n        text-align: left;\n        vertical-align: top;\n      "]);return P=function(){return t},t}function V(){var t=Object(r.a)(["\n          margin: 4px;\n        "]);return V=function(){return t},t}function B(){var t=Object(r.a)(["\n              display: inline-block;\n              width: 100px;\n            "]);return B=function(){return t},t}var L=function(t){var e=t.sheetName,n=t.data,r=Object(l.c)((function(){var t=function(t){return-1!==t.indexOf("\u6b66\u5668")}(e)?80:90,r=["character5","weapon5","character4","weapon4","weapon3"],c=["5\u661f\u89d2\u8272","5\u661f\u6b66\u5668","4\u661f\u89d2\u8272","4\u661f\u6b66\u5668","3\u661f\u6b66\u5668"],a=["#fac858","#ee6666","#5470c6","#91cc75","#73c0de"],i=Object.fromEntries(r.map((function(t,e){return[t,a[e]]}))),o=Object.fromEntries(r.map((function(t){return[t,0]}))),u=Object.fromEntries(r.map((function(t,e){return[t,c[e]]}))),l=[];n.forEach((function(t){5===t.\u661f\u7ea7&&l.push(t),o["".concat(function(t){return"\u6b66\u5668"===t.\u7c7b\u522b}(t)?"weapon":"character").concat(t.\u661f\u7ea7)]+=1}));var f=0===l.length?null:A()(l)[0],h=f?n.length-n.lastIndexOf(f)-1:n.length,s=r.filter((function(t){return 0!==o[t]})),d=s.map((function(t){return{value:o[t],name:u[t]}})),p=s.map((function(t){return i[t]}));return{name:e,chartSelected:Object(b.a)({},u.weapon3,!(n.length>20)),poolMax:t,chartData:d,chartColors:p,fromTime:n[0].date,toTime:n[n.length-1].date,totalCount:n.length,leftCount:h,fiveStarCount:l.length,fourStarCount:o.weapon4+o.character4,threeStarCount:o.weapon3,fiveStarHistory:l,fiveStarAverage:k()(l,(function(t){return t.\u4fdd\u5e95\u5185}))}}),[n],e),i=Object(f.useRef)(),o=Object(f.useCallback)((function(t){i.current=t;var e={fontFamily:E.c,fontStyle:"normal"};t.setOption({textStyle:{fontFamily:E.c,fontStyle:"normal"},title:{text:r.name,left:"center",textStyle:e},tooltip:{trigger:"item"},legend:{top:"10%",left:"center"}})}),[]);Object(f.useEffect)((function(){var t=i.current;t&&t.setOption({legend:{left:"center",selected:r.chartSelected},color:r.chartColors,series:[{name:r.name,type:"pie",top:50,startAngle:70,radius:"70%",data:r.chartData}]})}),[r]);var u=function(t){return M(t/r.poolMax)};function h(t,e,n){return Object(c.c)(c.a,{children:[Object(c.c)("span",{style:n?{color:n}:void 0,children:[Object(c.c)("span",{css:Object(a.a)(B()),children:[t,"\uff1a",e]}),"[",z(e,r.totalCount),"]"]}),Object(c.b)("br",{})]})}function s(t,e){return Object(c.c)("span",{style:{color:e},children:[" ",t," "]})}return Object(c.c)("div",{css:Object(a.a)(P()),children:[Object(c.b)(C,{css:Object(a.a)(I()),onCreate:o}),Object(c.c)("div",{css:Object(a.a)(D()),children:[Object(c.c)("p",{css:Object(a.a)(_()),children:[Object(c.b)("span",{children:F(r.fromTime)}),Object(c.b)("span",{children:" - "}),Object(c.b)("span",{children:F(r.toTime)})]}),Object(c.b)("p",{children:Object(c.c)("span",{children:["\u4e00\u5171\u62bd\u53d6",s(r.totalCount,"#1890ff"),"\u6b21, \u5df2\u7d2f\u8ba1",s(r.leftCount,u(r.leftCount)),"\u62bd\u672a\u51fa5\u661f"]})}),Object(c.b)("p",{children:[h("5\u661f",r.fiveStarCount,E.b.FIVE_STAR),h("4\u661f",r.fourStarCount,E.b.FOUR_STAR),h("3\u661f",r.threeStarCount,E.b.THREE_STAR)]}),0!==r.fiveStarHistory.length&&Object(c.c)(c.a,{children:[Object(c.c)("p",{children:["5\u661f\u5386\u53f2\u8bb0\u5f55\uff1a",r.fiveStarHistory.map((function(t){return function(t){return Object(c.c)("span",{style:{color:u(t.\u4fdd\u5e95\u5185)},css:Object(a.a)(V()),children:[t.\u540d\u79f0,"[",t.\u4fdd\u5e95\u5185,"]"]},t.\u603b\u6b21\u6570)}(t)}))]}),Object(c.c)("p",{children:["5\u661f\u5e73\u5747\u51fa\u8d27\u6b21\u6570\uff1a",s(r.fiveStarAverage.toFixed(2),u(r.fiveStarAverage))]})]})]})]})},N=n(367);function U(){var t=Object(r.a)(["5\u661f\u5e73\u5747\u51fa\u8d27\u6b21\u6570\uff1a",""]);return U=function(){return t},t}function J(){var t=Object(r.a)(["","\n","\n",""],["","\\n","\\n",""]);return J=function(){return t},t}function G(){var t=Object(r.a)(["","\n","\n",""],["","\\n","\\n",""]);return G=function(){return t},t}function W(){var t=Object(r.a)(["\u4e00\u5171","\u62bd\uff0c\u5df2\u7d2f\u8ba1","\u62bd\u672a\u51fa5\u661f"]);return W=function(){return t},t}function q(){var t=Object(r.a)(["",""]);return q=function(){return t},t}function K(t){return"".concat(t,"px ").concat(E.c)}v.a([O.a,j.a,m.a,x.a,y.a]);var Q=function(t){return"\n"===t};function X(t,e){var n,r=e.text,c=e.width,a=e.letterSpace,i=void 0===a?0:a,o=e.lineHeight,u=e.setup,l={x:0,y:0},f=[];if(u&&(n=u(t),f.push(u)),void 0===o){var h=t.font.match(/\d\dpx/);if(null===h)throw new Error("match error");o=1.3*parseFloat(h[0])}var s=Array.isArray(r)?r:[r],b=0;function d(){l.y+=o,b=Math.max(l.x,b),l.x=0}var p=void 0===c?function(e){if(Q(e))return d();var n=t.measureText(e).width;f.push({char:e,x:l.x,y:l.y}),l.x+=n+i}:function(e){if(Q(e))return d();var n=t.measureText(e).width;l.x+n+i>c?(d(),p(e)):(f.push({char:e,x:l.x,y:l.y}),l.x+=n+i)};return s.forEach((function(e){var n,r;"string"===typeof e?n=e:(n=e.text,e.setup&&(r=e.setup(t),f.push(e.setup)));for(var c=0;c<n.length;c++)p(n[c]);r&&(r(t),f.push(r))})),n&&(n(t),f.push(n)),{draw:function(e,n){f.forEach((function(r){if("function"===typeof r)r(t);else{var c=r.char,a=r.x,i=r.y;t.fillText(c,e+a,n+i)}}))},width:0===b?l.x:b,height:l.y+o}}function Y(t,e){return{text:" "+t+" ",setup:function(t){var n=t.fillStyle;return t.fillStyle=e,function(){t.fillStyle=n}}}}var Z=450,$=325,tt=function(t,e){var n=e.totalCount,r=e.poolMax,c=e.fiveStarCount,a=e.fourStarCount,i=e.threeStarCount,o=e.fiveStarHistory,u=e.fiveStarAverage,l=e.fromTime,f=e.toTime,h=e.leftCount,s=function(t,e){var n=e.width,r=e.letterSpace,c=void 0===r?0:r,a=e.lineHeight,i=e.setup;return function(e){for(var r=[],o=0;o<e.length;o++)if(r.push(e[o]),o<(arguments.length<=1?0:arguments.length-1)){var u=o+1<1||arguments.length<=o+1?void 0:arguments[o+1];Array.isArray(u)?r.push.apply(r,Object(N.a)(u)):r.push(u)}return X(t,{text:r,width:n,letterSpace:c,lineHeight:a,setup:i})}}(t,{width:400}),b=function(){t.font=K(16),t.textBaseline="top",t.textAlign="left"},d=function(t){return M(t/r)},p=function(t){return Y(t,d(t))};b();var v=0,g=s(q(),Y("".concat(F(l)," - ").concat(F(f)),"#808080")),O=g.width,j=g.height,m=g.draw;v+=j+4;var x=s(W(),Y(n,"#1890ff"),p(h)),y=(x.width,x.height),w=x.draw;v+=y+4;var S=s(G(),Y("5\u661f\uff1a".concat(c),E.b.FIVE_STAR),Y("4\u661f\uff1a".concat(a),E.b.FOUR_STAR),Y("3\u661f\uff1a".concat(i),E.b.THREE_STAR)),C=S.width,T=S.height,A=S.draw;v+=T+4;var R,k=s(J(),Y("[".concat(z(c,n),"]"),E.b.FIVE_STAR),Y("[".concat(z(a,n),"]"),E.b.FOUR_STAR),Y("[".concat(z(i,n),"]"),E.b.THREE_STAR)).draw;if(0!==o.length){var H=s(["5\u661f\u5386\u53f2\u8bb0\u5f55\uff1a"],o.map((function(t){return Y("".concat(t.\u540d\u79f0,"[").concat(t.\u4fdd\u5e95\u5185,"]"),d(t.\u4fdd\u5e95\u5185))}))),_=H.height,D=H.draw;v+=_+4;var I=s(U(),p(parseFloat(u.toFixed(2)))),P=I.height,V=I.draw;v+=P+4,R=function(t,e){D(t,e),V(t,e+_+4)}}return{width:400,height:v,draw:function(t,e){var n={x:t+25,y:e};b(),m(n.x+200-O/2,n.y),n.y+=j+4,w(n.x,n.y),n.y+=y+4,A(n.x,n.y),k(n.x+C+50,n.y),n.y+=T+4,R&&R(n.x,n.y)}}};function et(t){var e=X(t,{text:"https://genshin-gacha-analyzer.vercel.app/",letterSpace:1,setup:function(t){t.font=K(13),t.fillStyle="#988b81",t.textBaseline="middle"}}),n=e.width,r=(e.height,e.draw);return{height:20,draw:function(e,c,a){t.strokeStyle="#e0d6cb",t.lineCap="round",t.lineWidth=2;var i=c+10;t.beginPath(),t.moveTo(e+20,i),t.lineTo(e+a/2-n/2-20,i),t.closePath(),t.stroke(),t.beginPath(),t.moveTo(e+a/2+n/2+20,i),t.lineTo(e+a-20,i),t.closePath(),t.stroke(),r(e+a/2-n/2,i)}}}var nt=n(145),rt=n(37),ct=n(96),at=n(53);function it(){var t=Object(r.a)(["\n          text-align: center;\n          margin-bottom: 48px;\n        "]);return it=function(){return t},t}function ot(){var t=Object(r.a)(["\n          text-align: center;\n          margin: 10px 0;\n        "]);return ot=function(){return t},t}function ut(){var t=Object(r.a)(["\n            position: fixed;\n            right: 64px;\n            z-index: 999;\n          "]);return ut=function(){return t},t}function lt(){var t=Object(r.a)(["\n            position: absolute;\n            right: 12px;\n            z-index: 999;\n          "]);return lt=function(){return t},t}var ft=function(t){var e=t.sheetNames,n=t.onGetData,r=Object(f.useMemo)((function(){return e.map((function(t){return n(t)}))}),[e]),h=Object(l.b)(),b=Object(rt.b)().isVertical,d=Object(f.useCallback)((function(){var t="renderChartPng";i.b.loading({content:"\u751f\u6210\u56fe\u7247\u4e2d...",key:t}),function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=document.createElement("canvas"),c=r.getContext("2d"),a=document.createElement("canvas");a.width=Z,a.height=$;var i={fontFamily:E.c,fontStyle:"normal"},o=g.b(a,{renderer:"canvas",width:Z,height:300});o.setOption({textStyle:{fontFamily:E.c,fontStyle:"normal"},title:{left:"center",textStyle:i},tooltip:{trigger:"item"},legend:{top:"10%",left:"center"},animation:!1});var u={x:0,y:0},l=[],f=0,h=document.createElement("canvas");h.width=Z*t.length,h.height=$;var s=h.getContext("2d");t.forEach((function(t,n){o.setOption({title:{text:t.name},legend:{selected:t.chartSelected},color:t.chartColors,series:[{name:t.name,type:"pie",top:50,startAngle:70,radius:"70%",data:t.chartData}]}),s.drawImage(a,0,0,Z,$,n*Z,0,Z,$);var r,i,b,d=tt(c,t),p=d.height,v=d.draw;e?f+=p+$+10:f=Math.max(f,p+$),r=u.x,i=u.y,b=n,l.push((function(){return c.drawImage(h,b*Z,0,Z,$,r,i,Z,$)})),l.push((function(){return v(r,i+$)})),e?u.y=f:u.x+=Z}));var b=et(c),d=b.height,p=b.draw,v=e?Z:u.x,O=f+d;r.width=v,r.height=O,c.fillStyle="#fff",c.fillRect(0,0,v,O),l.forEach((function(t){return t()}));p((v-Z)/2,f,Z),n(r,c),o.dispose(),[a,r,h].forEach((function(t){t.width=0,t.height=0}))}(Object.values(h),b,(function(e,n){try{e.toBlob((function(e){Object(nt.saveAs)(e,"charts.png"),i.b.success({content:"\u751f\u6210\u56fe\u7247\u6210\u529f",key:t})}))}catch(r){throw i.b.error({content:"\u751f\u6210\u56fe\u7247\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\u6216\u66f4\u6362\u6d4f\u89c8\u5668",key:t}),new Error(r)}}))}),[b]);return Object(c.c)("div",{children:[Object(c.b)(o.a,{children:Object(c.c)("span",{children:["\u6b64\u9875\u9762\u53c2\u8003\u81ea\uff1a",Object(c.b)("a",{target:"_blank",href:"https://github.com/biuuu/genshin-gacha-export",children:"github\u94fe\u63a5"})]})}),E.e?Object(c.b)("div",{css:Object(a.a)(lt()),children:Object(c.b)(u.a,{type:"primary",onClick:d,icon:Object(c.b)(s.a,{}),size:"middle",shape:"circle"})}):Object(c.b)("div",{css:Object(a.a)(ut()),children:Object(c.b)(ct.a,{icon:Object(c.b)(s.a,{}),onClick:d,tip:"\u751f\u6210\u56fe\u7247",placement:"left"})}),Object(c.b)("div",{css:Object(a.a)(ot()),children:e.map((function(t,e){var n=r[e];if(n&&0!==n.length)return Object(c.b)(L,{sheetName:t,data:n},t)})).filter((function(t){return!!t}))}),Object(c.b)("div",{css:Object(a.a)(it()),children:Object(c.b)(u.a,{type:"primary",onClick:d,icon:Object(c.b)(s.a,{}),size:"middle",children:"\u751f\u6210\u56fe\u7247"})}),Object(c.b)(at.a,{mode:"bottom"})]})}}}]);